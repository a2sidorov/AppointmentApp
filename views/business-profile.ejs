<% 'use strict'; %>
<!DOCTYPE html>
<html>
<head>
	<title>Profile</title>
	<% include partials/head %>
</head>
  <body>

  <% include partials/business-navbar %>

  <div class="grid-container">

    <div class="header">

      <% include partials/header %>

      <H2>Profile</H2>

    </div>

    <div class="profile-form">

      <form action="/<%= user._id %>" method="post" id="form1">

        <label for="firstname">First Name</label>
        <input type="text" name="firstname" value="<%= user.firstname %>">
      
        <label for="lastname">Last Name</label>
        <input type="text" name="lastname" value="<%= user.lastname %>">

        <label for="Service">Service [under dev]</label>
        <input type="text" name="speciality">

        <label for="location">Location [under dev]</label>
        <input type="text" name="location">

        <label for="workdays">Work days</label>

        <div class=workdays>
          <ul>
            <% (function () { %>
              <% const week = ['Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa', 'Su'];%>
              <% let i; %>
              <% for (i  = 0; i < week.length; i++) { %>
                <% if (user.workdays.includes(week[i])) { %>
                  <li class="checked" onclick="checkDay(this)"><%= week[i] %></li>
                  <input type="text" name="workdays" value="<%= week[i] %>">
                <% } else { %>
                  <li onclick="checkDay(this)"><%= week[i] %></li>
                  <input type="text" name="workdays" value="">
                <% } %>
              <% } %>
            <% })(); %>
          </ul>
        </div>
        
        <div class="workhours">
          <label for="time">Working hours</label>
          <ul class="clock">
            <% (function() { %>
              <% let h, m, hh, mm, rad, numTxt, left, right, top, bottom, position; %>
              <% let angle = 270; %>
              <% let x = 0; %>
              <% let y = 0; %>
              <% let d = 75; %>

              <% for (h = 0; h < 24; h++) { %>
                <% for (m = 0; m < 60; m += 30) { %>

                  <% hh = h.toString().length === 2 ? h : '0' + h; %>
                  <% mm = m.toString().length === 2 ? m : '0' + m; %>

                  <% if (h === 0 && m === 0) { %>
                    <% numTxt = "M"; %>
                  <% } else if (h === 12 && m === 0) { %>
                    <% numTxt = "N"; %>
                  <% } else if (h < 12 && m === 0 ) { %>
                    <% numTxt = h; %>
                  <% } else if (h > 12 && m === 0) { %>
                    <% numTxt = h - 12; %>
                  <% } else { %>
                    <% numTxt = mm; %>
                  <% } %>
               
                  <% rad = angle * (Math.PI / 180); %>
                  <% x = Math.cos(rad) * d; %>
                  <% y = Math.sin(rad) * d; %>
                  <% position = `position: absolute; left: ${x}px; right: ${x}px; top: ${y}px; bottom: ${y}px` %>

                  <% if (user.workhours.includes(`${hh}:${mm}`)) { %>
                    <li class="checked" onclick="checkTime(this)" style="<%= position %>"><%= numTxt %></li>
                    <input type="text" style="<%= position %>" name="workhours" value="<%= hh %>:<%= mm %>" data-time="<%= hh %>:<%= mm %>">
                  <% } else { %>
                    <li onclick="checkTime(this)" style="<%= position %>"><%= numTxt %></li>
                    <input type="text" style="<%= position %>" name="workhours" value="" data-time="<%= hh %>:<%= mm %>">
                  <% } %>

                  <% angle = angle === 360 ? 15 : angle + 15; %>
                  <% d += 1.5; %>
                <% } %>
              <% } %>
            <% })();%>
          </ul>
        </div>
          

        <div id="holidays">
          <label for="time">Upcoming holidays</label>
          <% for (let i = 0; i < allHolidays.length; i++) { %>
            <% if (user.holidays.includes(allHolidays[i].date)) { %>
              <span>
                 <input type="checkbox" name="holidays" value="<%= allHolidays[i].date %>" checked> 
                <label><%= allHolidays[i].event %></label>
                <label>(<%= allHolidays[i].date %>)</label>  
              </span>
             
            <% } else { %>
              <span>
                 <input type="checkbox" name="holidays" value="<%= allHolidays[i].date %>">
                <label><%= allHolidays[i].event %></label>
                 <label>(<%= allHolidays[i].date %>)</label>
              </span>
             
            <% } %>
          <% } %>
        </div>

        <div class="exceptionDates">
          <label for="time">Exception days</label>
          <div id="excDate">
            <!-- <% for (let i = 0; i < user.exceptionDates.length; i++) { %>
            <input type="date" name="exceptionDates" value="<%= user.exceptionDates[i] %>">
          <% } %>      -->
          </div>
          <button class="addBtn" type="button" onclick="addExcDate()">&#43;</button>
        </div>
          
		  
    </form>
  </div>
  <button class="submitBtn" type="submit" form="form1">Save</button>

	<script src="public/script.js"></script>
</body>
</html>